<!-- 
  This file is part of the GetWVKeys project (https://github.com/GetWVKeys/getwvkeys)
  Copyright (C) 2022-2024 Notaghost, Puyodead1 and GetWVKeys contributors 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 -->

{% extends "base.html" %} {% block title %}API Documentation{% endblock %} {% block content %}
<section class="api">
    <header>
        <h1 class="section-title">GetWVKeys API Documentation</h1>
    </header>

    <div id="sections">
        <section>
            <h2>Authentication</h2>
            <p>All requests must include an API key header</p>
            <pre><code>X-API-Key: {{ current_user.api_key if current_user.api_key else "YOUR API KEY HERE" }}</code></pre>
        </section>

        <section>
            <h2>POST /api</h2>
            <section>
                <h3>Request Body</h3>
                <pre><code>{
  "license_url": "string",                  // REQUIRED. Widevine license server URL
  "pssh": "base64-encoded string",          // REQUIRED. PSSH data
  "proxy": "string",                        // OPTIONAL. Proxy in username:password@host:port
  "device_hash": "string",                  // OPTIONAL. Device hash to use
  "headers": "string",                      // OPTIONAL. Additional headers in key:value
  "force": true | false,                    // OPTIONAL. Bypass server cache
  "certificate": "string",                  // OPTIONAL. Service certificate - Widevine only
  "downgrade": true | false,                // OPTIONAL. PlayReady only
  "is_curl": true | false,                  // OPTIONAL. If true, server performs the license request directly
  "response": "string",                     // OPTIONAL*. License server response (for second step)
  "session_id": "string",                   // OPTIONAL*. Session ID from challenge generation
  "is_curl": true | false,                  // OPTIONAL. If true, server performs the license request directly and return JSON
}</code></pre>
            </section>

            <section>
                <h3>Behavior</h3>
                <span>The request behaves differently depending on the parameters</span>
                <ul>
                    <li>
                        <strong>When <code>is_curl</code> is false or omitted</strong>: Server generates a challenge for you to send to the license server (ex: cases where the
                        license server uses a non-standard request body).
                    </li>
                    <li>
                        <strong>When <code>is_curl</code> is true</strong>: Server performs the license request itself and returns keys.
                    </li>
                    <li>
                        <strong>To decrypt license responses</strong>: Send the base64 license in <code>response</code> along with <code>session_id</code>, and all other original
                        parameters.
                    </li>
                </ul>
            </section>

            <section>
                <h4>Response (when is_curl is false)</h4>
                <p>Server returns a generated challenge</p>
                <pre><code>{
  "challenge": "string",
  "session_id": "string",
  "device": "string", // Device Hash
  "security_level": "string" // Security Level of the device, prefixed with SL (PlayReady) or L (Widevine)
}</code></pre>
            </section>

            <section>
                <h4>Response (Key Result)</h4>
                <p>Returned when is_curl is true, or when posting back the license server response</p>
                <pre><code>{
  "keys": [
    {
      "added_at": number, // unix timestamp
      "key": "string",
      "license_url": "string"
    }
  ],
  "kid": "string",
  "device": "string", // Device Hash
  "security_level": "string" // Security Level of the device, prefixed with SL (PlayReady) or L (Widevine)
  "session_id": "string"
}</code></pre>
                <p><strong>Note:</strong> The <code>key</code> field is always in the format <code>kid:key</code>.</p>
            </section>

            <section>
                <h4>Response (Cached Key Result)</h4>
                <p>Identified by X-Cache header, should always be set as "HIT" if present</p>
                <pre><code>{
  "keys": [
    {
      "added_at": number, // unix timestamp
      "key": "string",
      "license_url": "string"
    }
  ],
  "kid": "string"
}</code></pre>
                <p><strong>Note:</strong> The <code>key</code> field is always in the format <code>kid:key</code>.</p>
            </section>
        </section>
    </div>
</section>
{% endblock %}
